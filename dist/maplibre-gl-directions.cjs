"use strict";var Ae=Object.defineProperty;var Ne=(t,i,e)=>i in t?Ae(t,i,{enumerable:!0,configurable:!0,writable:!0,value:e}):t[i]=e;var u=(t,i,e)=>(Ne(t,typeof i!="symbol"?i+"":i,e),e);Object.defineProperties(exports,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}});class $e{constructor(i){u(this,"map");u(this,"listeners",{});u(this,"oneTimeListeners",{});this.map=i}fire(i){var n,o;i.target=this.map;const e=i.type;(n=this.listeners[e])==null||n.forEach(s=>s(i)),(o=this.oneTimeListeners[e])==null||o.forEach(s=>{var a,l;s(i);const r=(a=this.oneTimeListeners[e])==null?void 0:a.indexOf(s);r!==void 0&&~r&&((l=this.oneTimeListeners[e])==null||l.splice(r,1))})}on(i,e){this.listeners[i]=this.listeners[i]??[],this.listeners[i].push(e)}off(i,e){var o,s;const n=(o=this.listeners[i])==null?void 0:o.indexOf(e);n!==void 0&&~n&&((s=this.listeners[i])==null||s.splice(n,1))}once(i,e){this.oneTimeListeners[i]=this.oneTimeListeners[i]??[],this.oneTimeListeners[i].push(e)}}class N{constructor(i,e,n){u(this,"type");u(this,"target");u(this,"originalEvent");u(this,"data");this.type=i,this.originalEvent=e,this.data=n}}class ee{constructor(i,e,n){u(this,"type");u(this,"target");u(this,"originalEvent");u(this,"data");this.type=i,this.originalEvent=e,this.data=n}}const je={api:"https://router.project-osrm.org/route/v1",profile:"driving",requestOptions:{},requestTimeout:null,makePostRequest:!1,sourceName:"maplibre-gl-directions",pointsScalingFactor:1,linesScalingFactor:1,sensitiveWaypointLayers:["maplibre-gl-directions-waypoint","maplibre-gl-directions-waypoint-casing"],sensitiveSnappointLayers:["maplibre-gl-directions-snappoint","maplibre-gl-directions-snappoint-casing"],sensitiveRoutelineLayers:["maplibre-gl-directions-routeline","maplibre-gl-directions-routeline-casing"],sensitiveAltRoutelineLayers:["maplibre-gl-directions-alt-routeline","maplibre-gl-directions-alt-routeline-casing"],dragThreshold:10,refreshOnMove:!1,bearings:!1},L={snapline:"#3893FF",altRouteline:"#F3F3F3",routelineFoot:"#F3F3F3",routelineBike:"#F3F3F3",routeline:"#3893FF",congestionLow:"#3893FF",congestionHigh:"#FF4D4D",hoverpoint:"#30a856",snappoint:"#cb3373",snappointHighlight:"#e50d3f",waypointFoot:"#3665ff",waypointFootHighlight:"#0942ff",waypointBike:"#63c4ff",waypointBikeHighlight:"#0bb8ff",waypoint:"#7b51f8",waypointHighlight:"#6d26d7"},le=["case",["==",["get","profile",["get","arriveSnappointProperties"]],"foot"],L.routelineFoot,["==",["get","profile",["get","arriveSnappointProperties"]],"bike"],L.routelineBike,["interpolate-hcl",["linear"],["get","congestion"],0,L.routeline,1,L.congestionLow,100,L.congestionHigh]],he=["case",["==",["get","profile"],"foot"],["case",["boolean",["get","highlight"],!1],L.waypointFootHighlight,L.waypointFoot],["==",["get","profile"],"bike"],["case",["boolean",["get","highlight"],!1],L.waypointBikeHighlight,L.waypointBike],["case",["boolean",["get","highlight"],!1],L.waypointHighlight,L.waypoint]],pe=["case",["boolean",["get","highlight"],!1],L.snappointHighlight,L.snappoint];function we(t=1,i=1,e="maplibre-gl-directions"){const n=["interpolate",["exponential",1.5],["zoom"],0,["case",["boolean",["get","highlight"],["==",["get","type"],"HOVERPOINT"]],14*t,12*t],5,["case",["boolean",["get","highlight"],["==",["get","type"],"HOVERPOINT"]],14*t,12*t],18,["case",["boolean",["get","highlight"],["==",["get","type"],"HOVERPOINT"]],33*t,28*t]],o=["interpolate",["exponential",1.5],["zoom"],0,["case",["boolean",["get","highlight"],["==",["get","type"],"HOVERPOINT"]],9*t,7*t],5,["case",["boolean",["get","highlight"],["==",["get","type"],"HOVERPOINT"]],9*t,7*t],18,["case",["boolean",["get","highlight"],["==",["get","type"],"HOVERPOINT"]],21*t,16*t]],s=["interpolate",["exponential",1.5],["zoom"],0,3*i,5,3*i,18,10*i],r=["interpolate",["exponential",1.5],["zoom"],0,["case",["boolean",["get","highlight"],!1],10*i,7*i],5,["case",["boolean",["get","highlight"],!1],10*i,7*i],18,["case",["boolean",["get","highlight"],!1],32*i,23*i]];return[{id:`${e}-snapline`,type:"line",source:e,layout:{"line-cap":"round","line-join":"round"},paint:{"line-dasharray":[3,3],"line-color":L.snapline,"line-opacity":.65,"line-width":3},filter:["==",["get","type"],"SNAPLINE"]},{id:`${e}-alt-routeline-casing`,type:"line",source:e,layout:{"line-cap":"butt","line-join":"round"},paint:{"line-color":L.altRouteline,"line-opacity":.55,"line-width":r},filter:["==",["get","route"],"ALT"]},{id:`${e}-alt-routeline`,type:"line",source:e,layout:{"line-cap":"butt","line-join":"round"},paint:{"line-color":L.altRouteline,"line-opacity":.85,"line-width":s},filter:["==",["get","route"],"ALT"]},{id:`${e}-routeline-casing`,type:"line",source:e,layout:{"line-cap":"butt","line-join":"round"},paint:{"line-color":le,"line-opacity":.55,"line-width":r},filter:["==",["get","route"],"SELECTED"]},{id:`${e}-routeline`,type:"line",source:e,layout:{"line-cap":"butt","line-join":"round"},paint:{"line-color":le,"line-opacity":.85,"line-width":s},filter:["==",["get","route"],"SELECTED"]},{id:`${e}-hoverpoint-casing`,type:"circle",source:e,paint:{"circle-radius":n,"circle-color":L.hoverpoint,"circle-opacity":.65},filter:["==",["get","type"],"HOVERPOINT"]},{id:`${e}-hoverpoint`,type:"circle",source:e,paint:{"circle-radius":o,"circle-color":L.hoverpoint},filter:["==",["get","type"],"HOVERPOINT"]},{id:`${e}-snappoint-casing`,type:"circle",source:e,paint:{"circle-radius":n,"circle-color":pe,"circle-opacity":.65},filter:["==",["get","type"],"SNAPPOINT"]},{id:`${e}-snappoint`,type:"circle",source:e,paint:{"circle-radius":o,"circle-color":pe},filter:["==",["get","type"],"SNAPPOINT"]},{id:`${e}-waypoint-casing`,type:"circle",source:e,paint:{"circle-radius":n,"circle-color":he,"circle-opacity":.65},filter:["==",["get","type"],"WAYPOINT"]},{id:`${e}-waypoint`,type:"circle",source:e,paint:{"circle-radius":o,"circle-color":he},filter:["==",["get","type"],"WAYPOINT"]}]}const xe="useandom-26T198340PX75pxJACKVERYMINDBUSHWOLF_GQZbfghjklqvwyzrict";let De=(t=21)=>{let i="",e=crypto.getRandomValues(new Uint8Array(t));for(;t--;)i+=xe[e[t]&63];return i};function ce(t){return t&1?~(t>>1):t>>1}function de(t,i=5){const e=Math.pow(10,i);let n=0,o=0,s=0;const r=[];let a=0,l=0,c=null,d,p;for(;n<t.length;){c=null,a=0,l=0;do c=t.charCodeAt(n++)-63,l|=(c&31)<<a,a+=5;while(c>=32);d=ce(l),a=l=0;do c=t.charCodeAt(n++)-63,l|=(c&31)<<a,a+=5;while(c>=32);p=ce(l),o+=d,s+=p,r.push([s/e,o/e])}return r}function Fe(t,i){return t.geometries==="geojson"?i.coordinates:t.geometries==="polyline6"?de(i,6):de(i,5)}function ze(t,i,e){var n,o,s,r;if((n=t.annotations)!=null&&n.includes("congestion_numeric"))return((o=i==null?void 0:i.congestion_numeric)==null?void 0:o[e])??0;if((s=t.annotations)!=null&&s.includes("congestion"))switch(((r=i==null?void 0:i.congestion)==null?void 0:r[e])??""){case"unknown":return 0;case"low":return 1;case"moderate":return 34;case"heavy":return 77;case"severe":return 100;default:return 0}else return 0}function qe(t,i,e){return!t.geometries||t.geometries==="polyline"?Math.abs(i[0]-e[0])<=1e-5&&Math.abs(i[1]-e[1])<=1e-5:i[0]===e[0]&&i[1]===e[1]}function ge(t){return t.map(i=>[i.geometry.coordinates[0],i.geometry.coordinates[1]])}function ue(t){return t.map(i=>{var e,n,o;return Array.isArray((e=i.properties)==null?void 0:e.bearing)?[(n=i.properties)==null?void 0:n.bearing[0],(o=i.properties)==null?void 0:o.bearing[1]]:void 0})}function Ee(t){const i=we(t==null?void 0:t.pointsScalingFactor,t==null?void 0:t.linesScalingFactor,t==null?void 0:t.sourceName);return Object.assign({},je,{layers:i},t)}function Le(t,i,e){const n=t.makePostRequest?"post":"get";let o,s;if(n==="get")o=`${t.api}/${t.profile}/${i.join(";")}`,s=new URLSearchParams(t.requestOptions);else{o=`${t.api}/${t.profile}${t.requestOptions.access_token?`?access_token=${t.requestOptions.access_token}`:""}`;const r=new FormData;Object.entries(t.requestOptions).forEach(([a,l])=>{a!=="access_token"&&r.set(a,l)}),r.set("coordinates",i.join(";")),s=new URLSearchParams(r)}return t.bearings&&e&&s.set("bearings",e.map(r=>r?`${r[0]},${r[1]}`:"").join(";")),{method:n,url:o,payload:s}}function Me(t,i,e){return{type:"Feature",geometry:{type:"Point",coordinates:t},properties:{type:i,id:De(),...e??{}}}}function Se(t,i,e,n,o=!1){if(t.length!==i.length)return[];const s=t.map((r,a)=>({type:"Feature",geometry:{type:"LineString",coordinates:[[r[0],r[1]],[i[a][0],i[a][1]]]},properties:{type:"SNAPLINE"}}));return~n&&e!==void 0&&o&&(s.push({type:"Feature",geometry:{type:"LineString",coordinates:[[e[0],e[1]],[i[n][0],i[n][1]]]},properties:{type:"SNAPLINE"}}),s.push({type:"Feature",geometry:{type:"LineString",coordinates:[[e[0],e[1]],[i[n+1][0],i[n+1][1]]]},properties:{type:"SNAPLINE"}})),s}function Pe(t,i,e,n){return i.map((o,s)=>{const r=Fe(t,o.geometry),a=n.map(y=>y.geometry.coordinates);let l=0;const c=a.map((y,g)=>{const _=r.slice(l).findIndex(w=>qe(t,w,y)),E=g===a.length-1;if(_!==-1)l+=_;else if(E)return r.length-1;return l}).slice(1);let d=0;const p=c.map(y=>r.slice(d,d=y+1)),f=[];return p.forEach((y,g)=>{const _=De();y.forEach((E,w)=>{var v,R,C;const b=f[f.length-1],m=ze(t,(v=o.legs[g])==null?void 0:v.annotation,w);if(g===((R=b==null?void 0:b.properties)==null?void 0:R.legIndex)&&((C=b.properties)==null?void 0:C.congestion)===m)b.geometry.coordinates.push(E);else{const j=n[g].properties??{},W=n[g+1].properties??{},T={type:"Feature",geometry:{type:"LineString",coordinates:[]},properties:{id:_,routeIndex:s,route:s===e?"SELECTED":"ALT",legIndex:g,congestion:m,departSnappointProperties:j,arriveSnappointProperties:W}};b&&T.geometry.coordinates.push(b.geometry.coordinates[b.geometry.coordinates.length-1]),T.geometry.coordinates.push(E),f.push(T)}})}),f})}const Ue=Object.freeze(Object.defineProperty({__proto__:null,buildConfiguration:Ee,buildPoint:Me,buildRequest:Le,buildRoutelines:Pe,buildSnaplines:Se},Symbol.toStringTag,{value:"Module"}));class Ve extends $e{constructor(e,n){super(e);u(this,"configuration");u(this,"_interactive",!1);u(this,"_hoverable",!1);u(this,"buildRequest",Le);u(this,"buildPoint",Me);u(this,"buildSnaplines",Se);u(this,"buildRoutelines",Pe);u(this,"onMoveHandler");u(this,"onDragDownHandler");u(this,"onDragMoveHandler");u(this,"onDragUpHandler");u(this,"onClickHandler");u(this,"liveRefreshHandler");u(this,"profiles",[]);u(this,"_waypoints",[]);u(this,"snappoints",[]);u(this,"routelines",[]);u(this,"selectedRouteIndex",0);u(this,"hoverpoint");u(this,"highlightedWaypoints",[]);u(this,"highlightedSnappoints",[]);u(this,"dragDownPosition",{x:0,y:0});u(this,"waypointBeingDragged");u(this,"waypointBeingDraggedInitialCoordinates");u(this,"departSnappointIndex",-1);u(this,"currentMousePosition",{x:0,y:0});u(this,"refreshOnMoveIsRefreshing",!1);u(this,"noMouseMovementTimer");u(this,"lastRequestMousePosition",{x:0,y:0});u(this,"allowRouteSwitch",!1);u(this,"abortController");this.map=e,this.configuration=Ee(n),this.onMoveHandler=this.onMove.bind(this),this.onDragDownHandler=this.onDragDown.bind(this),this.onDragMoveHandler=this.onDragMove.bind(this),this.onDragUpHandler=this.onDragUp.bind(this),this.onClickHandler=this.onClick.bind(this),this.liveRefreshHandler=this.liveRefresh.bind(this),this.init()}get waypointsCoordinates(){return ge(this._waypoints)}get snappointsCoordinates(){return this.snappoints.map(e=>[e.geometry.coordinates[0],e.geometry.coordinates[1]])}get snaplines(){var e,n,o;return this.buildSnaplines(this.waypointsCoordinates,this.snappointsCoordinates,(e=this.hoverpoint)==null?void 0:e.geometry.coordinates,this.departSnappointIndex,(o=(n=this.hoverpoint)==null?void 0:n.properties)==null?void 0:o.showSnaplines)}init(){this.map.addSource(this.configuration.sourceName,{type:"geojson",data:{type:"FeatureCollection",features:[]}});const e=this.map.getStyle().layers;let n;for(let o=0;o<e.length;o++)if(e[o].type==="symbol"){n=e[o].id;break}console.log("#### symbol id found",n),this.configuration.layers.forEach(o=>{console.log("#### layer.id",o.id),this.map.addLayer(o,n)})}async fetch({method:e,url:n,payload:o}){var r,a;const s=await(e==="get"?await fetch(`${n}?${o}`,{signal:(r=this.abortController)==null?void 0:r.signal}):await fetch(`${n}`,{signal:(a=this.abortController)==null?void 0:a.signal,method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:o})).json();if(s.code!=="Ok")throw new Error(s.message??"An unexpected error occurred.");return s}async fetchDirections(e){var o,s;(o=this.abortController)==null||o.abort();const n=this.interactive;if(this._waypoints.length>=2){this.fire(new ee("fetchroutesstart",e)),this.abortController=new AbortController;const r=this.abortController.signal;r.onabort=()=>{this.interactive=n},this.interactive=!1;let a;this.configuration.requestTimeout!==null&&(a=setTimeout(()=>{var g;return(g=this.abortController)==null?void 0:g.abort()},this.configuration.requestTimeout)),this.profiles.length||(this.profiles=[this.configuration.profile]);const l=[],c=[];this.profiles.reduce((g,_,E)=>{const w=E===this.profiles.length-1,b=E>0?this.profiles[E-1]:void 0,m=_===b,v=w?this._waypoints.length:m?g+1:g+2;return m?c[c.length-1].push(...this._waypoints.slice(g,v)):(c.push(this._waypoints.slice(g,v)),l.push(_)),v},0);const d=l.map((g,_)=>this.buildRequest({...this.configuration,profile:g},ge(c[_]),this.configuration.bearings?ue(c[_]):void 0));let p;try{p=await Promise.all(d.map(async g=>{let _;try{_=await this.fetch(g)}finally{this.fire(new ee("fetchroutesend",e,_))}return _}))}finally{((s=this.abortController)==null?void 0:s.signal.reason)!=="DESTROY"&&(this.interactive=n),this.abortController=void 0,clearTimeout(a)}const f=p.flatMap((g,_)=>{const E=l[_],w=g.waypoints.map((m,v)=>this.buildPoint(m.location,"SNAPPOINT",{profile:E,waypointProperties:c[_][v].properties??{}})),b=this.buildRoutelines(this.configuration.requestOptions,g.routes,this.selectedRouteIndex,w);return{snappoints:w,routelines:b}}),y=p.flatMap(g=>g.routes);this.snappoints=f.flatMap(g=>g.snappoints),this.routelines=f.flatMap(g=>g.routelines),y.length<=this.selectedRouteIndex&&(this.selectedRouteIndex=0)}else this.snappoints=[],this.routelines=[];this.draw(!1)}draw(e=!0){const n=[...this._waypoints,...this.snappoints,...this.snaplines,...this.routelines.reduce((s,r)=>e?s.concat(...r):s.concat(...r.map(a=>(a.properties&&(a.properties.route=a.properties.routeIndex===this.selectedRouteIndex?"SELECTED":"ALT"),a))),[])];this.hoverpoint&&n.push(this.hoverpoint);const o={type:"FeatureCollection",features:n};this.map.getSource(this.configuration.sourceName)&&this.map.getSource(this.configuration.sourceName).setData(o)}deHighlight(){this.highlightedWaypoints.forEach(e=>{e!=null&&e.properties&&(e.properties.highlight=!1)}),this.highlightedSnappoints.forEach(e=>{e!=null&&e.properties&&(e.properties.highlight=!1)}),this.routelines.forEach(e=>{e.forEach(n=>{n.properties&&(n.properties.highlight=!1)})})}onMove(e){var o,s,r,a;const n=this.map.queryRenderedFeatures(e.point,{layers:[...this.configuration.sensitiveWaypointLayers,...this.configuration.sensitiveSnappointLayers,...this.configuration.sensitiveRoutelineLayers,...this.configuration.sensitiveAltRoutelineLayers]})[0];if(this.deHighlight(),this.configuration.sensitiveWaypointLayers.includes((n==null?void 0:n.layer.id)??"")){this.map.getCanvas().style.cursor="pointer",this.interactive&&this.map.dragPan.disable();const l=this._waypoints.find(d=>{var p,f;return((p=d.properties)==null?void 0:p.id)===((f=n==null?void 0:n.properties)==null?void 0:f.id)}),c=l&&this.snappoints.find(d=>{var p,f,y;return((f=(p=d.properties)==null?void 0:p.waypointProperties)==null?void 0:f.id)===((y=l.properties)==null?void 0:y.id)});l&&(this.highlightedWaypoints=[l]),c&&(this.highlightedSnappoints=[c]),(o=this.highlightedWaypoints[0])!=null&&o.properties&&(this.highlightedWaypoints[0].properties.highlight=!0),(s=this.highlightedSnappoints[0])!=null&&s.properties&&(this.highlightedSnappoints[0].properties.highlight=!0),this.hoverpoint&&(this.hoverpoint=void 0)}else if(this.configuration.sensitiveSnappointLayers.includes((n==null?void 0:n.layer.id)??"")){this.map.getCanvas().style.cursor="pointer";const l=this.snappoints.findIndex(c=>{var d,p;return((d=c.properties)==null?void 0:d.id)===((p=n==null?void 0:n.properties)==null?void 0:p.id)});this.highlightedSnappoints=[this.snappoints[l]],this.highlightedWaypoints=[this._waypoints[l]],this.highlightedSnappoints[0].properties&&(this.highlightedSnappoints[0].properties.highlight=!0),this.highlightedWaypoints[0].properties&&(this.highlightedWaypoints[0].properties.highlight=!0),this.hoverpoint&&(this.hoverpoint=void 0)}else this.configuration.sensitiveRoutelineLayers.includes((n==null?void 0:n.layer.id)??"")?(this.map.getCanvas().style.cursor="pointer",this.interactive&&(this.map.dragPan.disable(),this.hoverpoint?this.hoverpoint.geometry.coordinates=[e.lngLat.lng,e.lngLat.lat]:this.hoverpoint=this.buildPoint([e.lngLat.lng,e.lngLat.lat],"HOVERPOINT",{departSnappointProperties:{...JSON.parse(((r=n==null?void 0:n.properties)==null?void 0:r.departSnappointProperties)??"{}")},arriveSnappointProperties:{...JSON.parse(((a=n==null?void 0:n.properties)==null?void 0:a.arriveSnappointProperties)??"{}")}})),this.routelines.forEach(l=>{l.forEach(c=>{var d,p;c.properties&&((d=c.properties)==null?void 0:d.id)===((p=n==null?void 0:n.properties)==null?void 0:p.id)&&(c.properties.highlight=!0)})})):this.configuration.sensitiveAltRoutelineLayers.includes((n==null?void 0:n.layer.id)??"")?(this.map.getCanvas().style.cursor="pointer",this.routelines.forEach(l=>{l.forEach(c=>{var d,p;c.properties&&((d=c.properties)==null?void 0:d.id)===((p=n==null?void 0:n.properties)==null?void 0:p.id)&&(c.properties.highlight=!0)})}),this.hoverpoint&&(this.hoverpoint=void 0)):(this.map.dragPan.enable(),this.map.getCanvas().style.cursor="",this.hoverpoint=void 0);this.draw()}onDragDown(e){var o,s,r,a,l,c;if(e.type==="touchstart"&&e.originalEvent.touches.length!==1||e.type==="mousedown"&&e.originalEvent.which!==1)return;const n=this.map.queryRenderedFeatures(e.point);if(n.length&&n[0].source===this.configuration.sourceName){const d=n.filter(p=>this.configuration.sensitiveWaypointLayers.includes((p==null?void 0:p.layer.id)??"")||this.configuration.sensitiveSnappointLayers.includes((p==null?void 0:p.layer.id)??"")||this.configuration.sensitiveRoutelineLayers.includes((p==null?void 0:p.layer.id)??""))[0];if(this.dragDownPosition=e.point,this.currentMousePosition=e.point,this.configuration.sensitiveWaypointLayers.includes((d==null?void 0:d.layer.id)??""))this.waypointBeingDragged=this._waypoints.find(p=>{var f,y;return((f=p.properties)==null?void 0:f.id)===((y=d==null?void 0:d.properties)==null?void 0:y.id)}),this.waypointBeingDraggedInitialCoordinates=(o=this.waypointBeingDragged)==null?void 0:o.geometry.coordinates;else if(this.configuration.sensitiveRoutelineLayers.includes((d==null?void 0:d.layer.id)??"")){if(this.departSnappointIndex=JSON.parse((s=d==null?void 0:d.properties)==null?void 0:s.legIndex),this.hoverpoint)if(this.configuration.refreshOnMove){const p=this.departSnappointIndex!==void 0?this.departSnappointIndex+1:void 0;this._addWaypoint([e.lngLat.lng,e.lngLat.lat],p,e),this.waypointBeingDragged=p?this._waypoints[p]:void 0,this.hoverpoint=void 0}else this.hoverpoint.geometry.coordinates=[e.lngLat.lng,e.lngLat.lat];else this.hoverpoint=this.buildPoint([e.lngLat.lng,e.lngLat.lat],"HOVERPOINT",{departSnappointProperties:{...JSON.parse(((r=d==null?void 0:d.properties)==null?void 0:r.departSnappointProperties)??"{}")},arriveSnappointProperties:{...JSON.parse(((a=d==null?void 0:d.properties)==null?void 0:a.arriveSnappointProperties)??"{}")}});(l=this.hoverpoint)!=null&&l.properties&&(this.hoverpoint.properties.showSnaplines=!0),~this.departSnappointIndex&&((c=this.snappoints[this.departSnappointIndex])!=null&&c.properties)&&(this.snappoints[this.departSnappointIndex].properties.highlight=!0,this.highlightedSnappoints.push(this.snappoints[this.departSnappointIndex]),this.snappoints[this.departSnappointIndex+1].properties.highlight=!0,this.highlightedSnappoints.push(this.snappoints[this.departSnappointIndex+1]))}this.map.off("touchstart",this.onMoveHandler),this.map.off("mousemove",this.onMoveHandler),e.type==="touchstart"?(this.map.on("touchmove",this.onDragMoveHandler),this.map.on("touchend",this.onDragUpHandler)):e.type==="mousedown"&&(this.map.on("mousemove",this.onDragMoveHandler),this.map.on("mouseup",this.onDragUpHandler)),this.draw()}}onDragMove(e){if(this.configuration.refreshOnMove&&(clearTimeout(this.noMouseMovementTimer),this.noMouseMovementTimer=setTimeout(this.liveRefreshHandler,300,e)),e.type==="touchmove"&&e.originalEvent.touches.length!==1)return e.originalEvent.preventDefault();e.type==="mousemove"&&e.originalEvent.which!==1||(this.waypointBeingDragged?this.waypointBeingDragged.geometry.coordinates=[e.lngLat.lng,e.lngLat.lat]:this.hoverpoint&&(this.hoverpoint.geometry.coordinates=[e.lngLat.lng,e.lngLat.lat]),this.currentMousePosition=e.point,this.draw(),this.configuration.refreshOnMove&&!this.refreshOnMoveIsRefreshing&&this.liveRefreshHandler(e))}async onDragUp(e){var n,o,s;if(this.configuration.refreshOnMove&&clearTimeout(this.noMouseMovementTimer),!(e.type==="mouseup"&&e.originalEvent.which!==1)){if((n=this.hoverpoint)!=null&&n.properties&&(this.hoverpoint.properties.showSnaplines=!1),Math.abs(e.point.x-((o=this.dragDownPosition)==null?void 0:o.x))>(this.configuration.dragThreshold>=0?this.configuration.dragThreshold:0)||Math.abs(e.point.y-((s=this.dragDownPosition)==null?void 0:s.y))>(this.configuration.dragThreshold>=0?this.configuration.dragThreshold:0))if(this.waypointBeingDragged){this.waypointBeingDragged.geometry.coordinates=[e.lngLat.lng,e.lngLat.lat];const r=new N("movewaypoint",e,{index:this._waypoints.indexOf(this.waypointBeingDragged),initialCoordinates:this.waypointBeingDraggedInitialCoordinates});this.fire(r);try{await this.fetchDirections(r)}catch(a){a instanceof DOMException&&a.name=="AbortError"||this.waypointBeingDraggedInitialCoordinates&&(this.waypointBeingDragged.geometry.coordinates=this.waypointBeingDraggedInitialCoordinates)}this.waypointBeingDragged=void 0,this.waypointBeingDraggedInitialCoordinates=void 0}else this.hoverpoint&&(this._addWaypoint([e.lngLat.lng,e.lngLat.lat],this.departSnappointIndex!==void 0?this.departSnappointIndex+1:void 0,e),this.hoverpoint=void 0);else this.waypointBeingDragged&&this.waypointBeingDraggedInitialCoordinates?(this.waypointBeingDragged.geometry.coordinates=this.waypointBeingDraggedInitialCoordinates,this.waypointBeingDragged=void 0,this.waypointBeingDraggedInitialCoordinates=void 0):this.hoverpoint&&(this.hoverpoint=void 0);this.deHighlight(),e.type==="touchend"?(this.map.off("touchmove",this.onDragMoveHandler),this.map.off("touchend",this.onDragUpHandler)):e.type==="mouseup"&&(this.map.off("mousemove",this.onDragMoveHandler),this.map.off("mouseup",this.onDragUpHandler)),this.map.on("touchstart",this.onMoveHandler),this.map.on("mousemove",this.onMoveHandler),this.map.dragPan.enable(),this.draw()}}async liveRefresh(e){var n,o,s,r;if(Math.abs(((n=this.lastRequestMousePosition)==null?void 0:n.x)-((o=this.currentMousePosition)==null?void 0:o.x))>(this.configuration.dragThreshold>=0?this.configuration.dragThreshold:0)||Math.abs(((s=this.lastRequestMousePosition)==null?void 0:s.y)-((r=this.currentMousePosition)==null?void 0:r.y))>(this.configuration.dragThreshold>=0?this.configuration.dragThreshold:0)){if(this.refreshOnMoveIsRefreshing=!0,this.lastRequestMousePosition=this.currentMousePosition,this.waypointBeingDragged){const a=new N("movewaypoint",e,{index:this._waypoints.indexOf(this.waypointBeingDragged),initialCoordinates:this.waypointBeingDraggedInitialCoordinates});this.fire(a);try{await this.fetchDirections(a)}catch{}}this.refreshOnMoveIsRefreshing=!1}}onClick(e){const n=this.map.queryRenderedFeatures(e.point,{layers:[...this.configuration.sensitiveWaypointLayers,...this.configuration.sensitiveSnappointLayers,...this.configuration.sensitiveAltRoutelineLayers,...this.configuration.sensitiveRoutelineLayers]})[0];if(this._interactive&&this.configuration.sensitiveWaypointLayers.includes((n==null?void 0:n.layer.id)??"")){const o=this._waypoints.findIndex(s=>{var r,a;return((r=s.properties)==null?void 0:r.id)===((a=n==null?void 0:n.properties)==null?void 0:a.id)});~o&&this._removeWaypoint(o,e)}else if(this._interactive&&this.configuration.sensitiveSnappointLayers.includes((n==null?void 0:n.layer.id)??"")){const o=this.snappoints.findIndex(s=>{var r,a;return((r=s.properties)==null?void 0:r.id)===((a=n==null?void 0:n.properties)==null?void 0:a.id)});~o&&this._removeWaypoint(o,e)}else(this.interactive||this.allowRouteSwitch)&&this.configuration.sensitiveAltRoutelineLayers.includes((n==null?void 0:n.layer.id)??"")?this.selectedRouteIndex=this.routelines.findIndex(o=>!!o.find(s=>{var r,a;return((r=s.properties)==null?void 0:r.id)===((a=n==null?void 0:n.properties)==null?void 0:a.id)})):this._interactive&&!this.configuration.sensitiveRoutelineLayers.includes((n==null?void 0:n.layer.id)??"")&&this._addWaypoint([e.lngLat.lng,e.lngLat.lat],void 0,e);this.draw(!1)}assignWaypointsCategories(){this._waypoints.forEach((e,n)=>{const o=n===0?"ORIGIN":n===this._waypoints.length-1?"DESTINATION":void 0;e.properties&&(e.properties.index=n,e.properties.category=o)})}async _addWaypoint(e,n,o){var r;(r=this.abortController)==null||r.abort(),n=n??this._waypoints.length,this._waypoints.splice(n,0,this.buildPoint(e,"WAYPOINT",this.configuration.bearings?{bearing:void 0}:void 0)),this.assignWaypointsCategories();const s=new N("addwaypoint",o,{index:n});this.fire(s),this.draw();try{await this.fetchDirections(s)}catch{}}async _removeWaypoint(e,n){var s;(s=this.abortController)==null||s.abort(),this._waypoints.splice(e,1),this.snappoints.splice(e,1),this.assignWaypointsCategories();const o=new N("removewaypoint",n,{index:e});this.fire(o),this.draw();try{await this.fetchDirections(o)}catch{}}get interactive(){return this._interactive}set interactive(e){this._interactive=e,e?(this.map.on("touchstart",this.onMoveHandler),this.map.on("touchstart",this.onDragDownHandler),this.map.on("mousedown",this.onDragDownHandler),this.map.on("click",this.onClickHandler),this.hoverable||(this.map.on("mousemove",this.onMoveHandler),this.map.on("click",this.onClickHandler))):(this.map.off("touchstart",this.onMoveHandler),this.map.off("touchstart",this.onDragDownHandler),this.map.off("mousedown",this.onDragDownHandler),this.hoverable||(this.map.off("mousemove",this.onMoveHandler),this.map.off("click",this.onClickHandler)))}get hoverable(){return this._hoverable}set hoverable(e){this._hoverable=e,e&&!this.interactive?(this.map.on("mousemove",this.onMoveHandler),this.map.on("click",this.onClickHandler)):this.interactive||(this.map.off("mousemove",this.onMoveHandler),this.map.off("click",this.onClickHandler))}get waypoints(){return this.waypointsCoordinates}set waypoints(e){this.setWaypoints(e)}get waypointsBearings(){return this.configuration.bearings?ue(this._waypoints):(console.warn("The `waypointsBearings` getter was referred to, but the `bearings` configuration option is not enabled!"),[])}set waypointsBearings(e){if(!this.configuration.bearings){console.warn("The `waypointsBearings` setter was referred to, but the `bearings` configuration option is not enabled!");return}this._waypoints.forEach((o,s)=>{(o.properties||(o.properties={})).bearing=e[s]});const n=new N("rotatewaypoints",void 0);this.fire(n),this.draw();try{this.fetchDirections(n)}catch{}}async setWaypoints(e,n=[]){var s;(s=this.abortController)==null||s.abort(),this.profiles=n.slice(0,e.length-1),this.profiles.length===0&&this.profiles.push(this.configuration.profile),this._waypoints=this.profiles.flatMap((r,a)=>{const l=a===this.profiles.length-1,c=a>0?this.profiles[a-1]:void 0,p=r===c?a+1:a,f=l?e.length:a+2;return e.slice(p,f).map((y,g)=>this.buildPoint(y,"WAYPOINT",{profile:r,...this.configuration.bearings?{bearing:this.waypointsBearings[g]}:void 0}))}),this.assignWaypointsCategories();const o=new N("setwaypoints",void 0);this.fire(o),this.draw();try{await this.fetchDirections(o)}catch{}}async addWaypoint(e,n){await this._addWaypoint(e,n)}async removeWaypoint(e){await this._removeWaypoint(e)}clear(){this.setWaypoints([]),this.routelines=[]}destroy(){var e;(e=this.abortController)==null||e.abort("DESTROY"),this.clear(),this.hoverable=!1,this.interactive=!1,this.configuration.layers.forEach(n=>{this.map.removeLayer(n.id)}),this.map.removeSource(this.configuration.sourceName)}}function $(){}function Re(t){return t()}function fe(){return Object.create(null)}function G(t){t.forEach(Re)}function Ie(t){return typeof t=="function"}function Ce(t,i){return t!=t?i==i:t!==i||t&&typeof t=="object"||typeof t=="function"}function Ge(t){return Object.keys(t).length===0}function D(t,i){t.appendChild(i)}function B(t,i,e){t.insertBefore(i,e||null)}function H(t){t.parentNode&&t.parentNode.removeChild(t)}function Ye(t,i){for(let e=0;e<t.length;e+=1)t[e]&&t[e].d(i)}function S(t){return document.createElement(t)}function P(t){return document.createElementNS("http://www.w3.org/2000/svg",t)}function X(t){return document.createTextNode(t)}function k(){return X(" ")}function Je(){return X("")}function J(t,i,e,n){return t.addEventListener(i,e,n),()=>t.removeEventListener(i,e,n)}function h(t,i,e){e==null?t.removeAttribute(i):t.getAttribute(i)!==e&&t.setAttribute(i,e)}function K(t){return t===""?null:+t}function Xe(t){return Array.from(t.childNodes)}function Ke(t,i){i=""+i,t.data!==i&&(t.data=i)}function Q(t,i){t.value=i??""}function A(t,i,e,n){e==null?t.style.removeProperty(i):t.style.setProperty(i,e,n?"important":"")}let V;function U(t){V=t}function Qe(){if(!V)throw new Error("Function called outside component initialization");return V}function Ze(t){Qe().$$.on_destroy.push(t)}const F=[],te=[];let z=[];const me=[],et=Promise.resolve();let ie=!1;function tt(){ie||(ie=!0,et.then(Te))}function ne(t){z.push(t)}const Z=new Set;let x=0;function Te(){if(x!==0)return;const t=V;do{try{for(;x<F.length;){const i=F[x];x++,U(i),it(i.$$)}}catch(i){throw F.length=0,x=0,i}for(U(null),F.length=0,x=0;te.length;)te.pop()();for(let i=0;i<z.length;i+=1){const e=z[i];Z.has(e)||(Z.add(e),e())}z.length=0}while(F.length);for(;me.length;)me.pop()();ie=!1,Z.clear(),U(t)}function it(t){if(t.fragment!==null){t.update(),G(t.before_update);const i=t.dirty;t.dirty=[-1],t.fragment&&t.fragment.p(t.ctx,i),t.after_update.forEach(ne)}}function nt(t){const i=[],e=[];z.forEach(n=>t.indexOf(n)===-1?i.push(n):e.push(n)),e.forEach(n=>n()),z=i}const ot=new Set;function st(t,i){t&&t.i&&(ot.delete(t),t.i(i))}function ye(t){return(t==null?void 0:t.length)!==void 0?t:Array.from(t)}function rt(t,i,e){const{fragment:n,after_update:o}=t.$$;n&&n.m(i,e),ne(()=>{const s=t.$$.on_mount.map(Re).filter(Ie);t.$$.on_destroy?t.$$.on_destroy.push(...s):G(s),t.$$.on_mount=[]}),o.forEach(ne)}function at(t,i){const e=t.$$;e.fragment!==null&&(nt(e.after_update),G(e.on_destroy),e.fragment&&e.fragment.d(i),e.on_destroy=e.fragment=null,e.ctx=[])}function lt(t,i){t.$$.dirty[0]===-1&&(F.push(t),tt(),t.$$.dirty.fill(0)),t.$$.dirty[i/31|0]|=1<<i%31}function Oe(t,i,e,n,o,s,r=null,a=[-1]){const l=V;U(t);const c=t.$$={fragment:null,ctx:[],props:s,update:$,not_equal:o,bound:fe(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(i.context||(l?l.$$.context:[])),callbacks:fe(),dirty:a,skip_bound:!1,root:i.target||l.$$.root};r&&r(c.root);let d=!1;if(c.ctx=e?e(t,i.props||{},(p,f,...y)=>{const g=y.length?y[0]:f;return c.ctx&&o(c.ctx[p],c.ctx[p]=g)&&(!c.skip_bound&&c.bound[p]&&c.bound[p](g),d&&lt(t,p)),f}):[],c.update(),d=!0,G(c.before_update),c.fragment=n?n(c.ctx):!1,i.target){if(i.hydrate){const p=Xe(i.target);c.fragment&&c.fragment.l(p),p.forEach(H)}else c.fragment&&c.fragment.c();i.intro&&st(t.$$.fragment),rt(t,i.target,i.anchor),Te()}U(l)}class He{constructor(){u(this,"$$");u(this,"$$set")}$destroy(){at(this,1),this.$destroy=$}$on(i,e){if(!Ie(e))return $;const n=this.$$.callbacks[i]||(this.$$.callbacks[i]=[]);return n.push(e),()=>{const o=n.indexOf(e);o!==-1&&n.splice(o,1)}}$set(i){this.$$set&&!Ge(i)&&(this.$$.skip_bound=!0,this.$$set(i),this.$$.skip_bound=!1)}}const ht="4";typeof window<"u"&&(window.__svelte||(window.__svelte={v:new Set})).v.add(ht);function ve(t){let i,e,n,o,s,r,a,l,c,d,p,f,y,g,_,E;return{c(){i=P("svg"),e=P("circle"),o=P("path"),r=P("g"),a=P("path"),c=P("path"),p=P("path"),y=P("animateTransform"),h(e,"cx","64.13"),h(e,"cy","64.13"),h(e,"r","27.63"),h(e,"fill",n=t[0].fill),h(o,"d","M64.13 18.5A45.63 45.63 0 1 1 18.5 64.13 45.63 45.63 0 0 1 64.13 18.5zm0 7.85a37.78 37.78 0 1 1-37.78 37.78 37.78 37.78 0 0 1 37.78-37.78z"),h(o,"fill-rule","evenodd"),h(o,"fill",s=t[0].fill),h(a,"d","M95.25 17.4a56.26 56.26 0 0 0-76.8 13.23L12.1 26.2a64 64 0 0 1 87.6-15.17z"),h(a,"fill",l=t[0].fill),h(c,"d","M95.25 17.4a56.26 56.26 0 0 0-76.8 13.23L12.1 26.2a64 64 0 0 1 87.6-15.17z"),h(c,"fill",d=t[0].fill),h(c,"transform","rotate(120 64 64)"),h(p,"d","M95.25 17.4a56.26 56.26 0 0 0-76.8 13.23L12.1 26.2a64 64 0 0 1 87.6-15.17z"),h(p,"fill",f=t[0].fill),h(p,"transform","rotate(240 64 64)"),h(y,"attributeName","transform"),h(y,"type","rotate"),h(y,"from","0 64 64"),h(y,"to","120 64 64"),h(y,"dur","360ms"),h(y,"repeatCount","indefinite"),h(i,"xmlns","http://www.w3.org/2000/svg"),h(i,"width",g=t[0].size),h(i,"height",_=t[0].size),h(i,"viewBox","0 0 128 128"),h(i,"xml:space","preserve"),h(i,"class",E=t[0].class)},m(w,b){B(w,i,b),D(i,e),D(i,o),D(i,r),D(r,a),D(r,c),D(r,p),D(r,y)},p(w,b){b&1&&n!==(n=w[0].fill)&&h(e,"fill",n),b&1&&s!==(s=w[0].fill)&&h(o,"fill",s),b&1&&l!==(l=w[0].fill)&&h(a,"fill",l),b&1&&d!==(d=w[0].fill)&&h(c,"fill",d),b&1&&f!==(f=w[0].fill)&&h(p,"fill",f),b&1&&g!==(g=w[0].size)&&h(i,"width",g),b&1&&_!==(_=w[0].size)&&h(i,"height",_),b&1&&E!==(E=w[0].class)&&h(i,"class",E)},d(w){w&&H(i)}}}function pt(t){let i,e=t[1]&&ve(t);return{c(){e&&e.c(),i=Je()},m(n,o){e&&e.m(n,o),B(n,i,o)},p(n,[o]){n[1]?e?e.p(n,o):(e=ve(n),e.c(),e.m(i.parentNode,i)):e&&(e.d(1),e=null)},i:$,o:$,d(n){n&&H(i),e&&e.d(n)}}}function ct(t,i,e){let{directions:n}=i,{configuration:o}=i,s;return n.on("fetchroutesstart",()=>{e(1,s=!0)}),n.on("fetchroutesend",()=>{e(1,s=!1)}),t.$$set=r=>{"directions"in r&&e(2,n=r.directions),"configuration"in r&&e(0,o=r.configuration)},[o,s,n]}class dt extends He{constructor(i){super(),Oe(this,i,ct,pt,Ce,{directions:2,configuration:0})}}const gt={fill:"#6d26d7",size:"24px",class:""};class ut{constructor(i,e){u(this,"controlElement");u(this,"directions");u(this,"configuration");this.directions=i,this.configuration=Object.assign({},gt,e)}onAdd(){return this.controlElement=document.createElement("div"),new dt({target:this.controlElement,props:{directions:this.directions,configuration:this.configuration}}),this.controlElement}onRemove(){this.controlElement.remove()}}function be(t,i,e){const n=t.slice();return n[16]=i[e],n[17]=i,n[18]=e,n}function ft(t){let i,e,n,o,s,r,a,l,c;function d(){t[11].call(i,t[17],t[18])}return{c(){i=S("input"),r=k(),a=S("span"),a.textContent="°",h(i,"type","number"),i.disabled=e=!t[16].enabled,h(i,"min",n=t[0].degreesMin),h(i,"max",o=t[0].degreesMax),h(i,"step",s=t[0].degreesStep),h(i,"class","maplibre-gl-directions-bearings-control__input"),h(a,"class","maplibre-gl-directions-bearings-control__text")},m(p,f){B(p,i,f),Q(i,t[16].degrees),B(p,r,f),B(p,a,f),l||(c=J(i,"input",d),l=!0)},p(p,f){t=p,f&2&&e!==(e=!t[16].enabled)&&(i.disabled=e),f&1&&n!==(n=t[0].degreesMin)&&h(i,"min",n),f&1&&o!==(o=t[0].degreesMax)&&h(i,"max",o),f&1&&s!==(s=t[0].degreesStep)&&h(i,"step",s),f&2&&K(i.value)!==t[16].degrees&&Q(i,t[16].degrees)},d(p){p&&(H(i),H(r),H(a)),l=!1,c()}}}function mt(t){let i,e=t[0].fixedDegrees+"",n,o;return{c(){i=S("span"),n=X(e),o=X("°"),h(i,"class","maplibre-gl-directions-bearings-control__text")},m(s,r){B(s,i,r),D(i,n),D(i,o)},p(s,r){r&1&&e!==(e=s[0].fixedDegrees+"")&&Ke(n,e)},d(s){s&&H(i)}}}function _e(t){let i,e,n,o,s,r,a,l,c,d,p,f=t[18],y,g,_,E,w,b,m,v,R,C,j,W,T,q,oe;function ke(){t[7].call(o,t[17],t[18])}const se=()=>t[8](r,f),re=()=>t[8](null,f);function Be(...O){return t[9](t[18],...O)}function We(){t[10].call(g,t[17],t[18])}function ae(O,M){return O[0].fixedDegrees?mt:ft}let Y=ae(t),I=Y(t);return{c(){i=S("div"),e=S("span"),e.textContent=`${t[18]+1}.`,n=k(),o=S("input"),s=k(),r=S("div"),a=P("svg"),l=P("circle"),p=P("circle"),y=k(),g=S("input"),m=k(),v=S("span"),v.textContent="°",R=k(),C=S("span"),C.textContent="±",j=k(),I.c(),W=k(),h(e,"class","maplibre-gl-directions-bearings-control__number text-slate-800"),h(o,"type","checkbox"),h(o,"class","maplibre-gl-directions-bearings-control__checkbox"),h(l,"r","5"),h(l,"cx","10"),h(l,"cy","10"),h(l,"fill","transparent"),h(l,"stroke","rgba(109, 38, 215, 0.65)"),h(l,"stroke-width","10"),h(l,"stroke-dasharray",c=t[16].degrees/3.6*31.42/100+" 31.42"),h(l,"transform",d="rotate("+(-90-t[16].degrees/2+t[16].angle-t[3])+")"),A(l,"transform-origin","10px 10px"),h(p,"r","6"),h(p,"cx","10"),h(p,"cy","10"),h(p,"fill","rgb(109, 38, 215)"),h(a,"height","20"),h(a,"width","20"),h(a,"viewBox","0 0 20 20"),h(a,"class","maplibre-gl-directions-bearings-control__waypoint-image"),A(a,"width",t[0].imageSize+"px"),A(a,"height",t[0].imageSize+"px"),A(a,"opacity",t[16].enabled?1:.25),h(r,"role","spinbutton"),h(r,"tabindex","0"),h(g,"type","number"),g.disabled=_=!t[16].enabled,h(g,"min",E=t[0].angleMin),h(g,"max",w=t[0].angleMax),h(g,"step",b=t[0].angleStep),h(g,"class","maplibre-gl-directions-bearings-control__input"),h(v,"class","maplibre-gl-directions-bearings-control__text"),h(C,"class","maplibre-gl-directions-bearings-control__text"),h(i,"class",T="maplibre-gl-directions-bearings-control__list-item "+(t[16].enabled?"maplibre-gl-directions-bearings-control__list-item--enabled":"maplibre-gl-directions-bearings-control__list-item--disabled")+" flex items-center gap-2 text-slate-800"+(t[16].enabled?"":"/50"))},m(O,M){B(O,i,M),D(i,e),D(i,n),D(i,o),o.checked=t[16].enabled,D(i,s),D(i,r),D(r,a),D(a,l),D(a,p),se(),D(i,y),D(i,g),Q(g,t[16].angle),D(i,m),D(i,v),D(i,R),D(i,C),D(i,j),I.m(i,null),D(i,W),q||(oe=[J(o,"change",ke),J(r,"mousedown",Be),J(g,"input",We)],q=!0)},p(O,M){t=O,M&2&&(o.checked=t[16].enabled),M&2&&c!==(c=t[16].degrees/3.6*31.42/100+" 31.42")&&h(l,"stroke-dasharray",c),M&10&&d!==(d="rotate("+(-90-t[16].degrees/2+t[16].angle-t[3])+")")&&h(l,"transform",d),M&1&&A(a,"width",t[0].imageSize+"px"),M&1&&A(a,"height",t[0].imageSize+"px"),M&2&&A(a,"opacity",t[16].enabled?1:.25),f!==t[18]&&(re(),f=t[18],se()),M&2&&_!==(_=!t[16].enabled)&&(g.disabled=_),M&1&&E!==(E=t[0].angleMin)&&h(g,"min",E),M&1&&w!==(w=t[0].angleMax)&&h(g,"max",w),M&1&&b!==(b=t[0].angleStep)&&h(g,"step",b),M&2&&K(g.value)!==t[16].angle&&Q(g,t[16].angle),Y===(Y=ae(t))&&I?I.p(t,M):(I.d(1),I=Y(t),I&&(I.c(),I.m(i,W))),M&2&&T!==(T="maplibre-gl-directions-bearings-control__list-item "+(t[16].enabled?"maplibre-gl-directions-bearings-control__list-item--enabled":"maplibre-gl-directions-bearings-control__list-item--disabled")+" flex items-center gap-2 text-slate-800"+(t[16].enabled?"":"/50"))&&h(i,"class",T)},d(O){O&&H(i),re(),I.d(),q=!1,G(oe)}}}function yt(t){let i,e,n,o=ye(t[1]),s=[];for(let r=0;r<o.length;r+=1)s[r]=_e(be(t,o,r));return{c(){i=S("div"),e=S("div");for(let r=0;r<s.length;r+=1)s[r].c();h(e,"class","maplibre-gl-directions-bearings-control__list flex flex-col max-h-96 overflow-y-auto"),h(i,"class",n="maplibre-gl-directions-bearings-control maplibregl-ctrl maplibregl-ctrl-group p-4 "+(t[1].length?"block":"hidden")+" bg-white text-base rounded")},m(r,a){B(r,i,a),D(i,e);for(let l=0;l<s.length;l+=1)s[l]&&s[l].m(e,null)},p(r,[a]){if(a&31){o=ye(r[1]);let l;for(l=0;l<o.length;l+=1){const c=be(r,o,l);s[l]?s[l].p(c,a):(s[l]=_e(c),s[l].c(),s[l].m(e,null))}for(;l<s.length;l+=1)s[l].d(1);s.length=o.length}a&2&&n!==(n="maplibre-gl-directions-bearings-control maplibregl-ctrl maplibregl-ctrl-group p-4 "+(r[1].length?"block":"hidden")+" bg-white text-base rounded")&&h(i,"class",n)},i:$,o:$,d(r){r&&H(i),Ye(s,r)}}}function vt(t,i,e){let{directions:n}=i,{configuration:o}=i;n.configuration.bearings||console.warn("The Bearings Control is used, but the `bearings` configuration option is not enabled!");let s=[];n.on("addwaypoint",r),n.on("removewaypoint",r),n.on("movewaypoint",r),n.on("setwaypoints",r);function r(){e(1,s=n.waypointsBearings.map((m,v)=>s[v]?s[v]:{enabled:o.defaultEnabled||!!m,angle:m?m[0]:o.angleDefault,degrees:m?m[1]:o.fixedDegrees?o.fixedDegrees:o.degreesDefault}))}r();let a;const l=[];let c=-1;function d(m,v){var R;(R=s[v])!=null&&R.enabled&&(c=v,document.addEventListener("mouseup",p),document.addEventListener("mousemove",f))}function p(){c=-1,document.removeEventListener("mouseup",p),document.removeEventListener("mousemove",f)}function f(m){const v=l[c];if(v){const R=v.getBoundingClientRect().x+o.imageSize/2,C=v.getBoundingClientRect().y+o.imageSize/2,j=m.pageX,W=m.pageY,q=Math.atan2(j-R,W-C)*(180/Math.PI)*-1+90;e(1,s[c].angle=90+q+y|0,s)}}Ze(()=>{document.removeEventListener("mouseup",p),document.removeEventListener("mousemove",f)});let y=0;o.respectMapBearing&&n.map.on("rotate",()=>e(3,y=n.map.getBearing()));function g(m,v){m[v].enabled=this.checked,e(1,s)}function _(m,v){te[m?"unshift":"push"](()=>{l[v]=m,e(2,l)})}const E=(m,v)=>d(v,m);function w(m,v){m[v].angle=K(this.value),e(1,s)}function b(m,v){m[v].degrees=K(this.value),e(1,s)}return t.$$set=m=>{"directions"in m&&e(5,n=m.directions),"configuration"in m&&e(0,o=m.configuration)},t.$$.update=()=>{t.$$.dirty&67&&(a&&clearTimeout(a),e(6,a=setTimeout(()=>{e(5,n.waypointsBearings=s.map(m=>m.enabled?[m.angle,m.degrees]:void 0),n)},o.debounceTimeout)))},[o,s,l,y,d,n,a,g,_,E,w,b]}let bt=class extends He{constructor(i){super(),Oe(this,i,vt,yt,Ce,{directions:5,configuration:0})}};const _t={defaultEnabled:!1,debounceTimeout:150,angleDefault:0,angleMin:0,angleMax:359,angleStep:1,fixedDegrees:0,degreesDefault:45,degreesMin:15,degreesMax:360,degreesStep:15,respectMapBearing:!1,imageSize:50};class wt{constructor(i,e){u(this,"controlElement");u(this,"directions");u(this,"configuration");this.directions=i,this.configuration=Object.assign({},_t,e)}onAdd(){return this.controlElement=document.createElement("div"),new bt({target:this.controlElement,props:{directions:this.directions,configuration:this.configuration}}),this.controlElement}onRemove(){this.controlElement.remove()}}exports.BearingsControl=wt;exports.LoadingIndicatorControl=ut;exports.MapLibreGlDirectionsRoutingEvent=ee;exports.MapLibreGlDirectionsWaypointEvent=N;exports.default=Ve;exports.layersFactory=we;exports.utils=Ue;
//# sourceMappingURL=maplibre-gl-directions.cjs.map
